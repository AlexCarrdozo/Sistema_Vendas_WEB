<!DOCTYPE html>
<html lang="pt-BR"
      xmlns:th="http://www.thymeleaf.org"
      th:replace="~{fragments/layout :: layout(head = ~{::head}, main = ~{::main})}">

<head th:replace="~{fragments/head :: head(links = ~{::link},title =~{::title})}">
  <title>Lista de Vendas</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
</head>

<body class="bg-light">
<main class="container py-5">

  <div class="card shadow-lg border-0 rounded-3">

    <div class="card-header bg-white border-bottom-0 pt-4 pb-3 px-4 d-flex flex-column flex-md-row justify-content-between align-items-center">
      <div>
        <h2 class="fw-bold text-primary mb-0"><i class="bi bi-receipt me-2"></i>Vendas Realizadas</h2>
        <p class="text-muted small mb-0">Gerencie e visualize o histórico de vendas</p>
      </div>
      <div class="mt-3 mt-md-0 d-flex gap-2">
        <a href="/carrinho/loja" class="btn btn-outline-primary rounded-pill px-4">
          <i class="bi bi-shop me-2"></i>Nova Compra
        </a>
        <a href="/carrinho/listar" class="btn btn-warning rounded-pill px-4 text-dark fw-bold position-relative shadow-sm">
          <i class="bi bi-cart-fill me-2"></i>Carrinho
        </a>
      </div>
    </div>

    <div class="card-body p-4">

      <div class="bg-light p-3 rounded-3 mb-4 border">
        <form th:action="@{/venda/list}" method="get" class="row g-2 align-items-center">
          <div class="col-auto">
            <span class="fw-semibold text-secondary"><i class="bi bi-funnel me-1"></i>Filtrar por data:</span>
          </div>
          <div class="col-auto flex-grow-1 flex-md-grow-0">
            <input type="date" class="form-control border-0 shadow-sm" name="data"
                   th:value="${dataFiltro != null ? #temporals.format(dataFiltro, 'yyyy-MM-dd') : ''}">
          </div>
          <div class="col-auto">
            <button class="btn btn-primary shadow-sm" type="submit">
              <i class="bi bi-search"></i>
            </button>
            <a class="btn btn-secondary shadow-sm" th:href="@{/venda/list}" title="Limpar Filtro">
              <i class="bi bi-x-lg"></i>
            </a>
          </div>
        </form>
      </div>

      <div class="table-responsive rounded-3 shadow-sm">
        <table class="table table-dark table-hover table-striped align-middle mb-0">
          <thead class="table-primary text-uppercase small">
          <tr>
            <th scope="col" class="py-3 ps-3"><i class="bi bi-hash me-1"></i>ID</th>
            <th scope="col" class="py-3"><i class="bi bi-calendar-event me-1"></i>Data</th>
            <th scope="col" class="py-3"><i class="bi bi-person me-1"></i>Cliente</th>
            <th scope="col" class="py-3"><i class="bi bi-cash-stack me-1"></i>Total</th>
            <th scope="col" class="py-3 text-end pe-3">Ações</th>
          </tr>
          </thead>
          <tbody>
          <tr th:each="v : ${vendas}">
            <td class="ps-3 fw-bold text-white-50" th:text="'#' + ${v.id}"></td>
            <td th:text="${#temporals.format(v.data, 'dd/MM/yyyy')}"></td>
            <td>
                          <span class="d-flex align-items-center gap-2">
                              <i class="bi bi-person-circle text-secondary"></i>
                              <span th:text="${v.pessoa != null ? (v.pessoa instanceof T(pweb.aula1509.model.entity.PessoaFisica) ? v.pessoa.nome : v.pessoa.razaoSocial) : 'Cliente Removido'}"
                                    th:class="${v.pessoa == null ? 'text-danger fst-italic' : ''}">
                              </span>
                          </span>
            </td>
            <td class="fw-bold text-success"
                th:text="'R$ ' + ${#numbers.formatDecimal(v.getTotal(), 1, 'POINT', 2, 'COMMA')}">
            </td>
            <td class="text-end pe-3">
              <a class="btn btn-sm btn-info text-white shadow-sm" th:href="@{/venda/detalhes/{id}(id=${v.id})}" title="Ver Detalhes">
                <i class="bi bi-eye-fill me-1"></i>Detalhes
              </a>
            </td>
          </tr>

          <tr th:if="${#lists.isEmpty(vendas)}">
            <td colspan="5" class="text-center py-5">
              <div class="d-flex flex-column align-items-center text-muted">
                <i class="bi bi-inbox display-4 mb-3 opacity-50"></i>
                <h5 class="fw-normal">Nenhuma venda encontrada</h5>
                <p class="small mb-0">Tente ajustar o filtro ou realize uma nova venda.</p>
              </div>
            </td>
          </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</main>
</body>
</html>